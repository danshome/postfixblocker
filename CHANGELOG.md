# Changelog

All notable changes to this project are documented here.
This file is auto-generated from Git history. Do not edit by hand.

## v0.0.1 - 2025-09-21
### Chores
- add auto-generated changelog and push in release; generate CHANGELOG.md

### Other
- Consolidate API proxy configuration into a single `proxy.json` file and update related references
- Annotate Flask route handlers with proper return types and utilize type hints consistently.
- **Drop PostgreSQL support; standardize on DB2 as the sole backend.**
- Add test reset infrastructure for backend and e2e environments
- - Update footer timestamp in coverage reports - Add release process guidelines to RELEASE.md - Expand Makefile targets with detailed build, lint, and test commands
- Enhance test suite: replace skips with `pytest.fail` for prerequisite validation, improve diagnostics, and ensure stricter execution conditions.
- - Update coverage timestamps and metrics in generated reports. - Enhance `ci-end` target to add machine-readable signals, JSON logging, and optional build enforcement for mail log consistency and coverage.
- Add test to balance mail log line counts in CI and update coverage artifacts
- Add extensive unit tests for logging, migrations, and Postfix control
- - Update code coverage timestamps and metrics - Add `npm ci` to workflow for installing frontend dependencies - Adjust DB2 table creation for byte-length constraints on VARCHAR fields - Refactor migrations to handle DB2-specific table creation logic
- - Update code coverage reports and timestamps. - Adjust Karma configuration to support CI environments and enforce coverage thresholds. - Update test results to reflect "passed" status.
- - Refactor `set_prop` to ensure `update_ts` is always updated
- - Refactor `set_prop` to ensure `update_ts` is always updated with `func.current_timestamp`. - Update database schema to increase `key` column limit to 1024 characters. - Adjust test results to handle interrupted status. - Regenerate code coverage and related artifacts.
- Refactor Postfix log tests to improve recipient-specific line counting and update coverage timestamps.
- **Refactor and enhance logging-related e2e tests and utility methods.**
- Remove unused `test_logs_debug_e2e.py` file.
- - Add E2E test for postfix log level behavior - Add unit test for /logs/lines endpoint - Simplify postfix log-level application logic - Enhance docstrings for public-facing functions - Update test coverage artifacts
- Add delayed SMTP delivery for baseline debug capture
- - Improve log-level-specific SMTP delivery simulation to support WARNING level alongside INFO. - Refactor burst mail function for better parameter handling. - Update coverage HTML and XML to reflect recent changes. - Regenerate coverage timestamps and hit records to align with updated logic.
- - Optimize `_submit_throttled` call by introducing a 36.0-second delay and updating burst values. - Improve table creation logic in `migrations.py` to be robust and idempotent across diverse database dialects. - Update `.gitignore` to include `.output.txt`. - Sync frontend code coverage timestamps and adjust line-rate metrics in XML coverage reports.
- "Improve SMTP activity handling with throttling, task cancellation, and environment-based enabling. Update coverage reports for frontend changes."
- Restrict pytest test discovery to `tests/` and exclude non-essential directories
- Updated coverage visualizations in `app.component.ts.html` to reflect improved test results. Updated status indicators and execution counts.
- - Refine Postfix log levels: Adjust `DEBUG` verbosity to 10, reorder `INFO` for clarity, and enhance type handling. - Expand debug burst threading logic with immediate bursts for baseline alignment. - Add Pytest as a dev/test dependency in `requirements-dev.txt` and `pyproject.toml`. - Update test expectations to align with new log level mappings. - Regenerate Istanbul code coverage timestamps.
- - Implement delayed debug bursts in `log_level.py` to analyze postfix logs more effectively. - Update `docker-compose.yml`:   - Replace DB2 image source and refine environment variables for better customization.   - Switch volume
- - Implement delayed debug bursts in `log_level.py` to analyze postfix logs more effectively. - Update `docker-compose.yml`:   - Replace DB2 image source and refine environment variables for better customization.   - Switch volume mapping to a host directory for `db
- Add healthchecks for Docker services and enforce dependency conditions
- "Inject controlled postfix/smtpd activity in DEBUG mode to support monotonicity checks in e2e tests."
- Update coverage timestamp in `coverage.xml`.
- Add code coverage report for `app.component.ts`
- Add coverage.xml file generated by coverage.py
- Enable test coverage reporting in CI and local workflows.
- "Adjust INFO_NUM to 3 for clearer CI logging"
- Add future annotations import to utils_wait test
- Remove `LICENSE.md` file
- - Update Python version to 3.9.21 in workflows and dependencies - Add `/venv/` to `.gitignore` - Introduce `.python-version` file
- Update CI workflow: add concurrency controls, switch to Ubuntu 22.04, adjust Python and Node setup options
- Improve postfix delivery evidence check in `test_logs_debug_e2e.py`.
- Improve postfix delivery evidence check in `test_logs_debug_e2e.py`.
- Simplify and optimize `resolve_mail_log_path` by removing redundant checks and logic.
- - Improve log file resolution logic to handle edge cases for multiple files and emptiness. - Refine rsyslog configuration for traditional file format and reliable processing. - Add a deterministic `BLOCKER_APPLY` log marker in blocker service for E2E test alignment. - Enhance E2E tests to prioritize deterministic markers while maintaining backward compatibility.
- Add rsyslog config for Postfix logging and increase log tail limit
- Update CI workflow to install Playwright with dependencies
- - Update README with finalized project details, including toolchain and usage instructions - Improve build and release process: clean `.egg-info` after builds - Correct project URLs to reflect new GitHub repository location

## v0.0.0 - 2025-09-16
### Refactoring
- Rename `app` package to `postfix_blocker` for improved clarity and modularity
- Integrate Angular Material components and animations; add server-side pagination, sorting, and filtering; implement inline editing for block list patterns. Update tests and API for new functionality.

### Documentation
- add or update project documentation (README, CONTRIBUTING, LICENSE, etc.)

### Other
- **Remove outdated refactor status documentation**
- Complete refactor milestone: remove blocker.py re-exports, tighten typing in app_factory, and finalize integration tests.
- **Refactor: Modularize Postfix Blocker - Core Services and Helpers**
- - Add `mailtester.sh` script for SMTP testing with various options. - Introduce Playwright E2E test for mode enforcement toggle and delivery behavior. - Update `postfix_blocker/blocker.py` to always fetch entries and apply changes based on marker or content hash.
- Add comprehensive E2E tests and logging improvements
- - Add persistent volume for DB2 data in `docker-compose.yml` - Introduce `_cleanup_api_state` pytest fixture to handle DB2/Addresses cleanup - Update Makefile to add `compose-down-hard` target for volume destruction
- Add `stack_running` helper to optimize compose rebuild logic and integrate `test-python-all` target into Makefile
- Add `log_step` helper for clearer Makefile output and improve task readability
- - Handle DB2 fetchall() returning None for empty results in `postfix_blocker/api.py`. - Increase test timeout to 10 minutes for DB2 initialization in Playwright configuration and tests. - Update Playwright tests to improve stability of row selection and assertion logic. - Remove outdated test result artifacts and mark tests as passed.
- - Add signal-based IPC to synchronize API and blocker refresh efficiently. - Enhance logging to handle handler-level setting failures gracefully. - Optimize E2E tests and unify CI workflow with `make ci`. - Update package dependencies, build config, and improve code formatting. - Improve Postfix blocker database schema handling and refresh flow.
- - Add signal-based IPC to synchronize API and blocker refresh efficiently. - Enhance logging to handle handler-level setting failures gracefully. - Optimize E2E tests and unify CI workflow with `make ci`. - Update package dependencies, build config, and improve code formatting. - Improve Postfix blocker database schema handling and refresh flow.
- Enhance logging configuration for API and blocker, including support for env-provided levels (int/names) and clearer initialization logs. Update supervisord to explicitly pass log-related environment variables.
- - Add debug logging to paginated list API responses - Default blocker log level to DEBUG for enhanced diagnostics - Update docker-compose environment variables to set DEBUG log levels
- Update logging paths to use `/var/log/postfix-blocker`, improve error handling in blocker.py, and update related documentation and configuration files.
- Add repository guidelines to AGENTS.md for structure, testing, and development practices
- Add pre-commit fix script and configure logging for Docker services
- - Add structured logging for API and blocker with optional file-based logs; integrate Docker log forwarding. - Update ESLint pre-commit hook to run lint:fix before fallback to lint. - Refactor and document logging improvements in `blocker` and `api`. - Ensure `/var/log/app` directory exists in Docker build. - Update contribution guidelines for running pre-commit hooks.
- Add pre-commit hooks for serverless lint tooling and ESLint flat config
- Update dependencies in `package-lock.json`:
- Add bulk input functionality to frontend UI
- Add production deployment documentation for RHEL 9.5 and update Docker configurations to align with Rocky Linux 9. Ensure PCRE map support validation and enhance compatibility for non-x86_64 architectures.
- **Tests: Add pytest setup for managing docker-compose lifecycle** Introduce `tests/conftest.py` to enable optional docker-compose lifecycle management during tests. Automatically triggered for backend/e2e tests or can be forced using `PYTEST_COMPOSE_ALWAYS=1` or `--compose-rebuild`. Update `requirements.txt` to include pytest.
- - **Frontend resilience & e2e improvements**:   - Enhance API error handling for database initialization delays (`app/api.py`).   - Update Angular `frontend/angular.json` to fix dev-server configuration.   - Extend Playwright configuration to support multi-project (Postgres & DB2) testing matrix.   - Add `proxy.db2.json` for DB2 API proxy and update e2e commands in `package.json`.   - Ensure stable test environments by improving Playwright test setup and avoiding test flakiness.   - Remove redundant reporters in `karma.conf.js` and guard against unnecessary test reloads.
- Migrate Angular app to standalone bootstrap with updated AppComponent and dependencies.
- Replace Jest with Karma for Angular test setup, update dependencies to align with Angular 20.
- Update devcontainer setup: replace `npm ci` with `npm install` in postCreateCommand and update dependencies in `package-lock.json`.
- Add Jest and Playwright configurations to frontend
- Add e2e tests, unit tests, and development container configuration for frontend
- Add e2e tests, unit tests, and development container configuration for frontend
- Add GitHub Actions CI workflow with unit, backend, and end-to-end test jobs; update dependencies and tests for dual Postgres and DB2 support.
- - Rename `tests/e2e_demo.py` to `tests/e2e_test.py` and update references. - Add `tests/test_db_backends.py` for optional backend smoke tests. - Update documentation: AGENTS.md and README.md with new test instructions and references.
- Refactor E2E demo script with extended functionality, environment configuration, and mass mail testing. Update Docker setup for improved compatibility and logging.
- Improve e2e demo import and docs
- Fix and document end-to-end demo
- Document project info and broken demo
- Use non-default ports and support Mac
- Fix Docker build context for postfix
- Add postfix blocker service with Docker and UI
- Initial commit
