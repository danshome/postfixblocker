[supervisord]
nodaemon=true

[program:postfix]
command=/usr/sbin/postfix start-fg
autostart=true

[program:rsyslog]
command=/usr/sbin/rsyslogd -n
autostart=true

[program:mail-logs]
command=/bin/sh -lc "mkdir -p /var/log && touch /var/log/mail.log && tail -n+1 -F /var/log/mail.log"
autostart=true

[program:blocker]
directory=/opt
environment=BLOCKER_LOG_LEVEL=%(ENV_BLOCKER_LOG_LEVEL)s,BLOCKER_LOG_FILE=%(ENV_BLOCKER_LOG_FILE)s,BLOCKER_PID_FILE=/var/run/postfix-blocker/blocker.pid
command=python3 -m postfix_blocker.blocker
autostart=true
priority=10
startsecs=2
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
redirect_stderr=true

[program:api]
directory=/opt
# Explicitly pass through container-provided env vars for clarity and portability
environment=API_HOST=0.0.0.0,API_LOG_LEVEL=%(ENV_API_LOG_LEVEL)s,API_LOG_FILE=%(ENV_API_LOG_FILE)s,BLOCKER_PID_FILE=/var/run/postfix-blocker/blocker.pid
command=python3 -m postfix_blocker.api
autostart=true
priority=20
startsecs=1
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
redirect_stderr=true
